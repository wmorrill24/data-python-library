# Data Ingestion and Access tool
Client library for uploading, searching, and downloading files from the data lake. 

## Requirements
- Python 3.9 or higher
- git Command-line tool installed and available
- Working in an environment where you can run `pip install` commands.

## Setup
Install the library from this GitHub repo into your environment using pip:
`pip install git+https://github.com/wmorrill24/data-python-library.git`

Import required methods from data_ingestion library at the top of your python code
`from data_ingestion import upload_file, search_file, generate_metadata_template, download_file`

Configure environment variable so the library knows the address of the API server. For now, this is done by entering the following into command line on Mac/Linux
`export INGEST_API_URL="http://10.118.140.255:8001"`

Or on Windows Powershell
`$env:INGEST_API_URL="http://10.118.140.255:8001"`



## Features
`generate_metadata_template(filepath: str, overwrite: bool = False)`
- Creates a blank metadata Yaml file at specified filepath.
- Filepath should be the name of the accompanying data file, replacing the extension with .yaml

`upload_file(data_file_path: str, metadata_file_path: str, api_url: str = None) -> dict`
- Uploads a data file and its corresponding YAML metadata file by calling the data management API. - - Returns the JSON response from the API upon success.

`search_file(**kwargs) -> pandas.DataFrame`
- Searches the metadata catalog. Accepts optional keyword arguments for filtering:
- `research_project_id: str`
- `author: str`
- `file_type: str`
- `experiment_type: str`
- `tags_contain: str`
- `date_after: str` (YYYY-MM-DD)
- `date_before: str` (YYYY-MM-DD) 
- Returns results as a pandas DataFrame.

`download_file(file_id: str, destination_path: str = None, api_url: str = None) -> str`
Downloads a file using its unique file_id. file_id can be copy-pasted from dataframe generated by search_files. 
- `destination_path:` Can be a directory (file will be saved with its original name) or a full path including a new filename. If omitted, defaults to the system's "Downloads" folder.
- Returns the absolute path to the downloaded file.

